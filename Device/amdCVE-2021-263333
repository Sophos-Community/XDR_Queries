##### SOPHOS COMMUNITY POST #####

https://community.sophos.com/intercept-x-endpoint/i/device/check-the-flaw-in-amd-platform-security-processor-cve-2021-26333

############ 

SELECT
  CASE
    WHEN (SELECT 1 FROM cpu_info WHERE model LIKE '%AMD%') AND (SELECT 1 FROM drivers WHERE device_name LIKE '%PSP%' AND version = '5.17.0.0') = 1
    THEN 'SYSTEM IS PATCHED'
    WHEN (SELECT 1 FROM cpu_info WHERE model LIKE '%AMD%') AND (SELECT 1 FROM drivers WHERE device_name LIKE '%PSP%' AND version <> '5.17.0.0') = 1
    THEN 'SYSTEM IS NOT PATCHED, UPDATE THE DRIVER'
    WHEN (SELECT 1 FROM cpu_info WHERE model NOT LIKE '%AMD%') = 1
    THEN 'SYSTEM HAS NON-AMD PROCESSOR'
  END Status
